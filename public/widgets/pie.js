// Initialise pies/* * */$(function(){    $('.widget[data-type=2]').each(function(){        var $container = $(this).find('.cf-pie');        var pId = $container.prop('id');        var config = $(this).data('config');        /*        // Set options per chart        customOptions = {};        customOptions.animation = false;        cf_rPs[pId].options = customOptions;        */        function reload(){            // Store chart information            cf_rPs[pId] = {};            cf_rPs[pId].data = [];            config.dataInfos = config.dataInfos || [];            var promises = config.dataInfos.map(function(dataInfo){                return $.get(                    '/api/data_sources/' + dataInfo.id                ).then(function(dataSource){                        return $.get(                            '/api/data_sources/' + dataInfo.id + '/records?limit=1'                        ).then(function(resp) {                                console.log('record: ', resp);                                resp.forEach(function (record) {                                    cf_rPs[pId].data.push([                                        dataSource.name, record.value                                    ]);                                });                            }                        );                });            });            $.when.apply(null, promises).done(function () {                $container.highcharts({                    chart: {                        plotBackgroundColor: null,                        plotBorderWidth: null,                        plotShadow: false,                        backgroundColor: 'rgba(0,0,0,0)'                    },                    title:{                        text: config.name,                        style: {                            color: 'lightgreen'                        }                    },                    tooptip: {                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'                    },                    plotOptions: {                        pie: {                            allowPointSelect: true,                            cursor: 'pointer',                            dataLabels: {                                enabled: true,                                format: '<b>{point.name}</b>: {point.percentage:.1f} %',                                color: 'lightgray',                                style: {                                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black',                                    fontSize: '14px'                                }                            }                        }                    },                    series: [{                        type: 'pie',                        name: config.name,                        data: cf_rPs[pId].data                    }]                });            });        }        setInterval(reload, config.reloadInterval);        reload();    });});